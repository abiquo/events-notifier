##########################################
#         Abiquo Events Notifier         #
##########################################

#       The Abiquo Platform
#       Cloud management application for hybrid clouds
#       Copyright (C) 2008-2013 - Abiquo Holding S.L. 
#
#       This application is free software; you can redistribute it and/or
#       modify it under the terms of the GNU LESSER GENERAL PUBLIC
#       LICENSE as published by the Free Software Foundation under
#       version 3 of the License
#
#       This software is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
#       LESSER GENERAL PUBLIC LICENSE v.3 for more details.
#
#       You should have received a copy of the GNU Lesser General Public
#       License along with this library; if not, write to the
#       Free Software Foundation, Inc., 59 Temple Place - Suite 330,
#       Boston, MA 02111-1307, USA.

1. Introduction

Python script that monitors Abiquo API and notifies new events through email based on rules.
Rules are stored in a SQLite database, which is queried by Notifier.

2. Configuration

    * Install the required python libraries:
	python-dateutil   
	python-pycurl 
 
    * Edit notifier.cfg and set correct values. More information at:
	http://wiki.abiquo.com/display/ABI23/Abiquo+Events+Notifier

    * Initialize rules database
        ./init_rules.py

3. Basic example

    * Create a rule that monitor VAPP_CREATE and VAPP_DELETE actions performed by user mmorata, and notify it to user sgirones. 
      Note that user sgirones must have a valid email.

        # ./add_rule.py --user sgirones --action VAPP_CREATE,VAPP_DELETE --owner mmorata

    * Verify rules are correctly created:

        # ./list_rules.py 

            --------------------------------------------------
            User: sgirones
            Actions: ['VAPP_CREATE', 'VAPP_DELETE']
            Owners: ['mmorata']
            --------------------------------------------------

    * Run the Events Notifier

        # ./main.py &
        
4. Rule's examples
        * Notify all users when their deploys/undeploys have finished:
            # ./add_rule.py -u all -a VAPP_POWERON,VAPP_POWEROFF

        * Notify cloud admin user all criticals:
            # ./add_rule.py -u sgirones -s CRITICAL
        
        
4. Final notes

    * Add rules while Notifier is running is ALLOWED. It will load rules every time it analizes events.
    * Valid actions are those listed by:
    
        http://wiki.abiquo.com/display/ABI23/Events+View#EventsView-TheActionsTable
        
    * Valid severity levels are those listed by:

        http://wiki.abiquo.com/display/ABI23/Events+View#EventsView-TheSeverityTable

