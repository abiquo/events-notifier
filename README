##########################################
#         Abiquo Events Notifier         #
##########################################

1. Introduction

Python script that monitors Abiquo Database and notifies new events through email based on rules.
Rules are stored in a SQLite database, which is queried by Notifier.

2. Configuration

    * Grant access to the Abiquo MySQL
    
        # mysql kinton
        > GRANT select ON kinton.metering TO 'event-notifier'@'events-notifier-server-ip';
        > GRANT select ON kinton.user TO 'event-notifier'@'events-notifier-server-ip';
        > flush privileges;
    
    * Edit notifier.cfg and put correct values.

3. Basic example

    * Init rules db

        # ./init_rules.py

    * Create a rule that monitor VAPP_CREATE and VAPP_DELETE actions performed by user mmorata, and notify it to user sgirones. Note that sgirones must have a valid email.

        # ./add_rule.py --user sgirones --action VAPP_CREATE,VAPP_DELETE --owner mmorata

    * Verify rules are correctly created:

        # ./list_rules.py 

            --------------------------------------------------
            User: sgirones
            Actions: ['VAPP_CREATE', 'VAPP_DELETE']
            Owners: ['mmorata']
            --------------------------------------------------

    * Run the Events Notifier

        # ./main.py &
        
4. Rule's examples
        * Notify all users when their deploys/undeploys have finished:
            # ./add_rule.py -u all -a VAPP_POWERON,VAPP_POWEROFF

        * Notify cloud admin user all criticals:
            # ./add_rule.py -u sgirones -s CRITICAL
        
        
4. Final notes

    * Add rules while Notifier is running is ALLOWED. It will load rules every time it analizes events.
    * Valid actions are those listed by:
    
        http://wiki.abiquo.com/display/ABI18/Events+View#EventsView-TheActionsTable
        
    * Valid severity levels are those listed by:

        http://wiki.abiquo.com/display/ABI18/Events+View#EventsView-TheSeverityTable


Troubleshooting

error:
    ImportError: No module named MySQLdb


solution:
    yum install MySQL-python
